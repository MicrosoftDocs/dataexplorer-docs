%%{ init: { 'flowchart': {'defaultRenderer': 'elk' } } }%%
graph TD
    %% Core AD Objects
    USER[User<br/>Domain Users]
    COMPUTER[Computer<br/>Domain Computers]
    GROUP[Group<br/>Security Groups]
    LOCALGROUP[ADLocalGroup<br/>Local Groups]
    
    %% AD Infrastructure
    DOMAIN[Domain<br/>AD Domains]
    OU[OU<br/>Organizational Units]
    CONTAINER[Container<br/>AD Containers]
    GPO[GPO<br/>Group Policy Objects]
    
    %% Certificate Infrastructure
    CERT[CertTemplate<br/>Certificate Templates]
    ENTCA[EnterpriseCA<br/>Certificate Authorities]
    ROOTCA[RootCA<br/>Root CAs]
    
    %% Domain Hierarchy & Containment
    DOMAIN -->|Contains| CONTAINER
    CONTAINER -->|Contains| USER
    CONTAINER -->|Contains| GROUP
    DOMAIN -->|Contains| OU
    OU -->|Contains| USER
    OU -->|Contains| COMPUTER
    
    %% Group Memberships
    USER -->|MemberOf| GROUP
    USER -->|MemberOf| LOCALGROUP
    GROUP -->|MemberOf| GROUP
    
    %% Administrative Access
    USER -->|AdminTo| COMPUTER
    GROUP -->|AdminTo| COMPUTER
    USER -->|GenericAll| USER
    GROUP -->|GenericAll| GROUP
    
    %% Dangerous Permissions
    USER -->|WriteDacl| GROUP
    GROUP -->|WriteOwner| CERT
    USER -->|GenericWrite| GPO
    
    %% Certificate Attack Paths
    USER -->|GenericAll| ROOTCA
    GROUP -->|WriteDacl| ENTCA
    
    %% Object Ownership
    GROUP -->|Owns| CONTAINER
    USER -->|Owns| CERT
    
    %% Styling
    classDef user fill:#e3f2fd,stroke:#1976d2,stroke-width:3px
    classDef computer fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef group fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef infrastructure fill:#f1f8e9,stroke:#689f38,stroke-width:2px
    classDef certificate fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef dangerous fill:#ffebee,stroke:#d32f2f,stroke-width:3px
    
    class USER user
    class COMPUTER computer
    class GROUP,LOCALGROUP group
    class DOMAIN,OU,CONTAINER,GPO infrastructure
    class CERT,ENTCA,ROOTCA certificate